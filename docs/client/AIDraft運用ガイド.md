# AIDraft 運用ガイド（V2.1: 統合管理シート方式）

## 🚀 初期設定（1回のみ）

### 1. 自動実行トリガーの設定
sheets/プロジェクトで以下を実行：

```javascript
setupTriggers(); // 全シート（3シート）の1時間ごと自動実行開始
```

### 2. OpenAI APIキーの設定
1. GASエディタ → 「プロジェクトの設定」
2. 「スクリプト プロパティ」タブ
3. プロパティ: `OPENAI_API_KEY`
4. 値: APIキーを入力

### 3. 動作確認
```javascript
// 各シートの動作テスト
testWeekendDent();    // WeekendDentシートテスト
testOtherSeminar();   // その他セミナーシートテスト
testInquiry();        // お問い合わせシートテスト
```

## 📋 日常運用

### Gmail下書きの確認・送信
1. **Gmailの下書きフォルダを開く**
2. **ラベルで絞り込み**
   - "AI自動回答_WeekendEnt"（WeekendDentシート）
   - "AI自動回答_その他"（その他セミナーシート）
   - "AI自動回答_お問い合わせ"（お問い合わせシート）
   - "AI自動回答_Gmail"（Gmail手動ラベル処理）
3. **下書き内容を確認・編集**
4. **送信**

### Gmail手動ラベル処理
1. **処理したいメールに手動でラベル付け**
   - ラベル名: "AI回答要求"
2. **自動処理を待つ（1時間ごと）**
   - または手動で `processLabeledEmails()` 実行
3. **下書きが作成されたら確認・送信**

### 処理状況の確認
**統合管理シートで確認（V2.1）**
```javascript
showStatistics(); // 処理統計情報の詳細表示
```

**または、スプレッドシート「AI処理管理」シートで直接確認**
- **A列**: 種別（WeekenDent/その他セミナー/お問い合わせ）
- **B列**: タイムスタンプ（元データとの紐付けキー）
- **C列**: 処理ステータス（完了/エラー/処理中/テスト実行）

### 自動実行の管理
```javascript
// 停止
deleteTriggers();

// 再開
setupTriggers(); // 3シート統合処理用
```

## 🔧 基本情報

### システム構成（V2.1統合版）
- **sheets/プロジェクト**: 3シート統合処理システム
  - WeekenDentシート（WeekendDentセミナー）
  - その他セミナーシート
  - お問い合わせシート
  - AI処理管理シート（処理状況一元管理）
- **gmail/プロジェクト**: Gmail手動ラベルによるAI下書き作成システム

### 重要な関数（V2.1統合版）
| 関数 | 用途 |
|---|---|
| `setupTriggers()` | 自動実行開始（3シート統合） |
| `deleteTriggers()` | 自動実行停止 |
| `checkConfig()` | 設定確認・管理シート統計表示 |
| `showStatistics()` | 処理統計詳細表示（日常監視用） |
| **テスト関数** | |
| `testWeekendDent()` | WeekendDentシート1件テスト |
| `testOtherSeminar()` | その他セミナーシート1件テスト |
| `testInquiry()` | お問い合わせシート1件テスト |
| **手動一括処理** | |
| `processWeekendDent()` | WeekendDentシート処理（最大20件） |
| `processOtherSeminar()` | その他セミナーシート処理（最大20件） |
| `processInquiry()` | お問い合わせシート処理（最大20件） |
| **gmail/プロジェクト** | |
| `processLabeledEmails()` | Gmail手動ラベル処理 |

## 🚨 トラブル時の対応

### 処理が動かない場合
1. ✅ APIキーが設定されているか
2. ✅ トリガーが有効か（⏰マークで確認）
3. ✅ 未処理データがあるか
4. ✅ Gmail権限が許可されているか

### 下書きが作成されない場合
1. ✅ メールアドレスが正しく入力されているか
2. ✅ エラーメッセージを確認
3. ✅ 手動テスト実行で問題を特定

### AI回答の品質について
- 不適切な回答は下書きを編集してから送信
- 専門的な内容は人手での確認を推奨

## 💰 料金について
- **OpenAI API**: 1件あたり0.1-0.3円程度
- **Google Apps Script**: 基本無料
- **使用量確認**: OpenAIダッシュボード

## 📞 サポート
問題発生時は以下の情報を添えて連絡：
- エラーメッセージ
- 発生日時
- どのプロジェクトか
- 処理データの概要