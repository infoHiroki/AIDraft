# 01_お問い合わせ - 技術仕様書

## プロジェクト概要
- **プロジェクト名**: 01_お問い合わせ
- **用途**: 歯科セミナーお問い合わせフォーム自動回答
- **GASプロジェクトID**: 設定済み

## スプレッドシート仕様
- **シートID**: `159ftLgPcrqdQU-W5UqpPcgrrZGado12kocXGFVnhzXI`
- **シート名**: `フォームの回答 1`
- **ヘッダー行**: 1行目

### カラム構成（固定）
| 列 | カラム名 | 内容 | 処理 |
|---|---|---|---|
| A | Timestamp | タイムスタンプ | 参照のみ |
| B | Email Address | メールアドレス | Gmail送信先 |
| C | 先生の歯科医院名 | 歯科医院名 | AI回答生成に使用 |
| D | お問い合わせ内容 | 質問内容 | **処理対象** |
| E | 事務局対応 | ステータス | 処理状況記録 |
| F | AI回答 | AI生成内容 | 回答詳細記録 |

## 処理ロジック
### 処理条件
- D列（お問い合わせ内容）に内容がある
- E列（事務局対応）が空

### 処理フロー
1. 未処理行を検索（最大20件）
2. お問い合わせ情報を整理
3. AI回答生成（AIService.generateDentalSeminarResponse）
4. Gmail下書き作成
5. ステータス更新（E列・F列）

## AI回答生成
### 入力データ
```javascript
{
  email: "メールアドレス",
  clinicName: "歯科医院名",
  inquiry: "お問い合わせ内容"
}
```

### 回答テンプレート
- 歯科セミナーに特化した丁寧な回答
- クリニック名を含む個別対応
- 具体的な情報提供

## Gmail設定
- **ラベル**: `AI自動回答_歯科セミナー`
- **件名形式**: セミナーお問い合わせの回答
- **送信者**: 設定済みGmailアカウント

## ステータス管理
- `処理中`: 処理開始時
- `AI回答作成済`: 正常完了
- `エラー`: 処理失敗
- `テスト実行`: テスト時

## 実行関数
- `processDentalSeminar()`: 定期実行（最大20件）
- `testDentalSeminarSingleRow()`: テスト実行（1件）
- `setupTrigger()`: 1時間間隔トリガー設定
- `checkConfig()`: 設定確認

## 設定項目
### スクリプトプロパティ
- `OPENAI_API_KEY`: OpenAI APIキー

### 制限事項
- 1実行あたり最大20件
- API使用量制限に注意
- 重複処理防止機能あり

## ファイル構成
```
01_お問い合わせ/
├── src/config/
│   ├── common.js           # API設定、ステータス定数
│   └── sheets.js           # スプレッドシート設定
├── src/processors/
│   └── dentalSeminarProcessor.js  # メイン処理ロジック
├── src/services/
│   ├── aiService.js        # OpenAI API連携
│   ├── gmailService.js     # Gmail操作
│   └── sheetService.js     # スプレッドシート操作
└── main.js                 # エントリーポイント
```

## デプロイ手順
1. Clasp設定確認
2. スクリプトプロパティ設定
3. スプレッドシート共有
4. `clasp push`でデプロイ
5. テスト実行で動作確認