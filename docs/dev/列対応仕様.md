# データマッピング仕様書

各プロジェクトのスプレッドシート列とシステム処理の対応関係

## 01_お問い合わせ

### スプレッドシート列構成
| 列 | 項目名 | 用途 | 例 |
|---|---|---|---|
| A | タイムスタンプ | 自動記録 | `2025/06/09 10:30:15` |
| B | メールアドレス | Gmail宛先 | `tanaka@clinic.com` |
| C | 歯科医院名 | AI回答生成 | `田中歯科クリニック` |
| D | 先生のお名前 | AI回答生成 | `田中太郎` |
| E | お悩みやご相談内容 | AI回答生成 | `インプラント治療について` |
| F | 質問があれば教えてください | **処理対象** | `保険適用について教えてください` |
| G | 事務局対応 | **ステータス出力** | `完了` |
| H | AI回答 | **統合回答出力** | `2025/06/09 14:25\nDraft ID: abc123\n────────────────\n田中歯科クリニック\n田中太郎先生\n...` |

### 処理フロー
1. **F列（質問）**に内容があり、**G列（ステータス）**が空の行を検出
2. **B, C, D, E, F列**の情報を使ってAI回答生成
3. Gmail下書き作成（宛先：B列）
4. **G列**にステータス、**H列**に統合情報を出力

---

## 02_単発

### スプレッドシート列構成
| 列 | 項目名 | 用途 | 例 |
|---|---|---|---|
| A | タイムスタンプ | 自動記録 | `2025/06/09 10:30:15` |
| B | メールアドレス | Gmail宛先 | `yamada@dental.com` |
| C | 歯科医院名 | AI回答生成 | `山田歯科医院` |
| D | 先生のお名前 | AI回答生成 | `山田花子` |
| E | セミナー感想 | AI回答生成 | `とても勉強になりました` |
| F | お支払い方法 | 参考情報 | `クレジットカード` |
| G | 相談したいもの | 参考情報 | `矯正治療` |
| H | 質問があれば教えてください | **処理対象** | `矯正の期間はどのくらいですか` |
| I | 事務局対応 | **ステータス出力** | `完了` |
| J | AI回答 | **統合回答出力** | `2025/06/09 15:10\nDraft ID: def456\n────────────────\n山田歯科医院\n山田花子先生\n...` |

### 処理フロー
1. **H列（質問）**に内容があり、**I列（ステータス）**が空の行を検出
2. **B, C, D, E, H列**の情報を使ってAI回答生成
3. Gmail下書き作成（宛先：B列）
4. **I列**にステータス、**J列**に統合情報を出力

---

## 03_WeekendEnt（動的列検索機能付き）

### スプレッドシート列構成（基本構成）
| 列 | 項目名 | 用途 | 例 |
|---|---|---|---|
| A | 内容 | セミナー種別 | `歯周病` |
| B | Timestamp | 自動記録 | `6/30/2024 20:32:14` |
| C | Email Address | Gmail宛先 | `hosokawa-shika7570@tulip.ocn.ne.jp` |
| D | 歯科医院名 | AI回答生成 | `ほそかわ歯科` |
| E | 先生のお名前 | AI回答生成 | `細川洋幸` |
| F | セミナーのご感想をお聞かせください | AI回答生成 | `興味深い` |
| G | (セミナー内容以外についての) ご質問があれば、ご記入ください | **処理対象** | `アイテロの操作方法などはどのように学ぶと良いでしょうか。` |
| H | 事務局対応 | **ステータス出力**（動的検索） | `回答不要` |
| I | AI回答 | **統合回答出力**（動的検索） | `2025/06/14 11:52\nDraft ID: r6626998959498151253\n────...` |
| J+ | 追加質問 | フォーム拡張時に追加 | `「グーグルマップ クチコミ77件プラス...」` |

### 動的列検索機能
- **事務局対応列**: ヘッダー名「事務局対応」で動的検索
- **AI回答列**: ヘッダー名「AI回答」で動的検索
- **自動列追加**: 必要な列がない場合は自動で追加
- **フォーム拡張対応**: 新しい質問が追加されても安全

### 処理フロー
1. **G列（質問）**に内容があり、**動的検索した事務局対応列**が空の行を検出
2. **C, D, E, F, G列**の情報を使ってAI回答生成
3. Gmail下書き作成（宛先：C列）
4. **動的検索した事務局対応列**にステータス、**動的検索したAI回答列**に統合情報を出力

---

## 共通仕様

### AI回答出力形式（統合）
```
2025/06/09 14:25
Draft ID: abc123def456
────────────────
[医院名]
[先生名]先生

GDX事務局 中村です。
お世話になります。

セミナーに参加していただき、ありがとうございました。
また、アンケートのご返答、ありがとうございます｡

先生から頂きました質問は以下です。

━━━━━━━━━━━━━━━━
[質問内容]
━━━━━━━━━━━━━━━━

以下、回答です。

━━━━━━━━━━━━━━━━
[AI生成回答]
━━━━━━━━━━━━━━━━

何かご質問があれば、お気軽に聞いて下さい。
どうぞよろしくお願いします。

GDX事務局 中村
seminar@globaldentalx.com
03-4510-4792
```

### 注意事項
- **上3行（日時・Draft ID・区切り線）**: スプレッドシートの管理情報のみ
- **Gmail下書き**: 区切り線以下の内容のみが実際のメール本文
- **ステータス**: `完了`、`エラー`、`テスト実行`のいずれか
- **処理対象**: 質問列に内容があり、ステータス列が空の行のみ

---

## 04_Gmailラベル自動回答

### Gmail処理仕様
| 項目 | 内容 | 例 |
|---|---|---|
| 処理対象 | `AI回答要求`ラベル付きメール | 手動でラベル付け |
| 取得情報 | 件名、送信者、本文 | `Re: 質問について` |
| AI処理 | メール内容から返信生成 | 適切な返信文を作成 |
| 出力先 | Gmail返信下書き | 下書きフォルダに作成 |
| ラベル変更 | `AI回答要求` → `AI自動回答_Gmail` | 処理済みとして分類 |

### 処理フロー
1. **`AI回答要求`ラベル**のメールを検索
2. **メール内容**（件名・送信者・本文）を取得
3. **AI回答生成**（メール返信として適切な内容）
4. **Gmail返信下書き作成**
5. **ラベル変更**（処理済みに分類）
6. **メールを既読化**

### 他プロジェクトとの違い
- **データソース**: スプレッドシート → **Gmail**
- **処理トリガー**: 列の値変化 → **手動ラベル付け**
- **出力管理**: スプレッドシート記録 → **Gmailラベル管理**

---

## プロジェクト間の違い

| 項目 | 01_お問い合わせ | 02_単発 | 03_WeekendEnt | 04_Gmailラベル |
|---|---|---|---|---|
| 質問列 | F列 | H列 | G列 | Gmail本文 |
| ステータス列 | G列 | I列 | **動的検索** | Gmailラベル |
| AI回答列 | H列 | J列 | **動的検索** | Gmail下書き |
| 相談内容項目 | E列（お悩み） | E列（感想） + G列（相談） | F列（感想） | メール全体 |
| 使用データ | B,C,D,E,F | B,C,D,E,H | C,D,E,F,G | 件名,送信者,本文 |
| データソース | スプレッドシート | スプレッドシート | スプレッドシート | Gmail |
| 処理トリガー | 行の更新 | 行の更新 | 行の更新 | ラベル付け |
| 特徴 | 固定列 | 固定列 | **動的列検索** | 別システム |