# 設定情報

## APIキー設定

### OpenAI API
- **設定場所**: GAS → プロジェクト設定 → スクリプトプロパティ
- **キー名**: `OPENAI_API_KEY`
- **値**: OpenAI APIキー（sk-proj-...）
- **モデル**: `gpt-4o-mini`

## スプレッドシート設定

### 共有設定
- **共有先**: `globaldental.seminar@gmail.com`
- **権限**: 編集者
- **必要性**: スプレッドシートへのアクセスに必須

### 01_お問い合わせ
- **ID**: `159ftLgPcrqdQU-W5UqpPcgrrZGado12kocXGFVnhzXI`
- **シート名**: `フォームの回答 1`
- **処理対象**: F列（質問）があり、G列（ステータス）が空
- **出力先**: G列（ステータス）+ H列（統合情報）
- **ラベル名**: `AI自動回答_お問い合わせ`

### 02_単発（動的列検索機能付き）
- **ID**: `1PPwXbBGdSLIC8yeQY33dNDlEqjdJ4X-PibaDPiWU6Io`
- **シート名**: `その他セミナー`
- **処理対象**: H列（質問）があり、**動的検索した事務局対応列**が空
- **出力先**: **動的検索した事務局対応列** + **動的検索したAI回答列**
- **ラベル名**: `AI自動回答_単発`
- **特徴**: フォームに新しい質問が追加されても自動対応

### 03_WeekendEnt（動的列検索機能付き）
- **ID**: `1PPwXbBGdSLIC8yeQY33dNDlEqjdJ4X-PibaDPiWU6Io`（02と同じスプレッドシート）
- **シート名**: `WeekenDent`（実際のシート名）
- **処理対象**: G列（質問）があり、**動的検索した事務局対応列**が空
- **出力先**: **動的検索した事務局対応列** + **動的検索したAI回答列**
- **ラベル名**: `AI自動回答_WeekendEnt`
- **特徴**: フォームに新しい質問が追加されても自動対応

## 動的列検索機能（02_単発、03_WeekendEnt）

### 機能概要
- **目的**: Googleフォームに質問が追加されても安全に動作
- **動作**: ヘッダー名で「事務局対応」「AI回答」列を動的検索
- **フォールバック**: 見つからない場合は自動で列を追加
- **キャッシュ**: 高速化のためのキャッシュ機能付き

### 安全性
- 既存データの上書きリスクなし
- 新しいフォーム質問が追加されても安全
- 列の順序が変わっても対応可能

## システム設定

### 処理制限
- **1回の最大処理件数**: 20件
- **自動実行間隔**: 1時間（setupTrigger()使用時）
- **タイムアウト**: Google Apps Script 6分制限

### Gmail設定
- **送信者**: 実行ユーザーのGmailアカウント
- **下書きラベル**: 自動作成・付与
- **自動送信**: なし（下書きのみ）
- **件名**: "Re: セミナーについてのご質問"

### 統合出力形式
```
2025/06/09 14:25
Draft ID: abc123def456
────────────────
[AI生成回答内容]
```

## プロジェクト別関数

### 01_お問い合わせ
- **メイン処理**: `processInquiries()` - 未処理問い合わせを最大20件まで自動処理
- **テスト実行**: `testSingleRow()` - 1件のみ処理してテスト実行として記録
- **設定確認**: `checkConfig()` - APIキー設定、シート接続状況の確認
- **トリガー設定**: `setupTrigger()` - 1時間ごとの定期実行トリガーを作成
- **トリガー削除**: `deleteTriggers()` - processInquiries用のトリガーを全削除

### 02_単発
- **メイン処理**: `processTanbatsu()` - 未処理質問を最大20件まで自動処理
- **テスト実行**: `testTanbatsuSingleRow()` - 1件のみ処理してテスト実行として記録
- **設定確認**: `checkConfig()` - APIキー設定、シート接続状況の確認
- **トリガー設定**: `setupTrigger()` - 1時間ごとの定期実行トリガーを作成
- **トリガー削除**: `deleteTriggers()` - processTanbatsu用のトリガーを全削除

### 03_WeekendEnt
- **メイン処理**: `processWeekendEnt()` - 未処理質問を最大20件まで自動処理
- **テスト実行**: `testWeekendEntSingleRow()` - 1件のみ処理してテスト実行として記録
- **設定確認**: `checkConfig()` - APIキー設定、シート接続状況の確認
- **トリガー設定**: `setupTrigger()` - 1時間ごとの定期実行トリガーを作成
- **トリガー削除**: `deleteTriggers()` - processWeekendEnt用のトリガーを全削除

### 04_Gmailラベル自動回答
- **メイン処理**: `processLabeledEmails()` - AI回答要求ラベル付きメールを最大10件まで自動処理
- **テスト実行**: `testSingleEmail()` - 1件のみ処理（ラベル変更なし）
- **設定確認**: `checkConfig()` - APIキー設定、Gmail権限の確認
- **トリガー設定**: `setupTrigger()` - 1時間ごとの定期実行トリガーを作成
- **トリガー削除**: `deleteTriggers()` - processLabeledEmails用のトリガーを全削除

## 内部アーキテクチャ関数

### Service系（共通）
- **AIService.generateSeminarQuestionResponse()** - AI回答生成
- **GmailService.createDraft()** - Gmail下書き作成とラベル付与
- **SheetService.updateStatus()** - 統合出力形式でステータス更新

### Processor系（プロジェクト別）
- **DentalSeminarProcessor.process()** - 01_お問い合わせ用業務ロジック
- **TanbatsuProcessor.process()** - 02_単発用業務ロジック
- **WeekendEntProcessor.process()** - 03_WeekendEnt用業務ロジック
- **LabelProcessor.process()** - 04_Gmailラベル用業務ロジック

## Gmail設定（04_Gmailラベル自動回答専用）

### ラベル設定
- **処理対象ラベル**: `AI回答要求` - 手動でメールに付けるラベル
- **処理済みラベル**: `AI自動回答_Gmail` - 処理完了後に自動変更

### 処理制限
- **1回の最大処理件数**: 10件
- **自動実行間隔**: 1時間（setupTrigger()使用時）
- **対象メール**: ラベル付きメールのみ

### Gmail動作
- **検索対象**: `AI回答要求`ラベル付きメール
- **除外条件**: `AI自動回答_Gmail`ラベル付きメール
- **処理後**: ラベル変更 + 既読化 + 返信下書き作成