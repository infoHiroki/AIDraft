# 02_その他セミナー - 技術仕様書

## プロジェクト概要
- **プロジェクト名**: 02_その他セミナー（旧：02_単発）
- **用途**: その他セミナー質問フォーム自動回答
- **GASプロジェクトID**: `1RwbvFaqEekdx3tGuYXjMaFU8LBJ4k0uCGbn5KYWkeGUdz5WlhKrLJ-fS`

## スプレッドシート仕様
- **シートID**: `1PPwXbBGdSLIC8yeQY33dNDlEqjdJ4X-PibaDPiWU6Io`
- **シート名**: `その他セミナー`
- **ヘッダー行**: 1行目

### カラム構成（固定 + 動的）
| 列 | カラム名 | 内容 | 処理 |
|---|---|---|---|
| A | Timestamp | タイムスタンプ | 参照のみ |
| B | Email Address | メールアドレス | Gmail送信先 |
| C | 先生の歯科医院名 | 歯科医院名 | AI回答生成に使用 |
| D | 先生のお名前 | 先生名 | AI回答生成に使用 |
| E | セミナーの感想をお聞かせください | 感想 | AI回答生成に使用 |
| F | 事務局対応 | ステータス | 処理状況記録 |
| G | 質問があれば教えてください | 質問内容 | **処理対象** |
| ? | AI回答 | AI生成内容 | **動的追加** |

## 処理ロジック
### 処理条件
- G列（質問）に内容がある
- F列（事務局対応）が空

### 処理フロー（簡潔化済み）
1. 未処理行を検索（最大20件）
2. AI回答列を動的検索/作成
3. 質問情報を整理してAI回答生成
4. Gmail下書き作成
5. 直接セル更新（F列・AI回答列）

### コード構成（44行に簡潔化）
```javascript
class OtherSeminarProcessor {
  static process() { return this._processRows(false); }
  static testSingleRow() { return this._processRows(true); }
  static _processRows(testMode = false) { /* 統合処理 */ }
  static _updateSheet(sheet, rowIndex, aiColumnIndex, status, draftId, content) { /* 直接更新 */ }
}
```

## AI回答生成
### 入力データ
```javascript
{
  email: "メールアドレス",
  clinicName: "歯科医院名", 
  doctorName: "先生名",
  impression: "セミナー感想",
  question: "質問内容"
}
```

### 回答テンプレート
- セミナー感想への感謝
- 質問に対する具体的回答
- 個別対応感のある丁寧な回答

## 動的列管理
### AI回答列検索・作成
```javascript
const aiColumnIndex = SheetService.getColumnIndexByHeader(
  sheet, 
  'AI回答', 
  { headerRow: 1, createIfNotFound: true }
);
```

### 特徴
- フォーム拡張時も安全
- 既存データの上書きなし
- 最右端に自動追加

## Gmail設定
- **ラベル**: `AI自動回答_その他セミナー`
- **件名形式**: セミナー質問の回答
- **送信者**: 設定済みGmailアカウント

## ステータス管理
- `処理中`: 処理開始時
- `AI回答作成済`: 正常完了
- `エラー`: 処理失敗
- `テスト実行`: テスト時

## 実行関数
- `processOtherSeminar()`: 定期実行（最大20件）
- `testOtherSeminarSingleRow()`: テスト実行（1件）
- `setupTrigger()`: 1時間間隔トリガー設定
- `checkConfig()`: 設定確認

## 設定項目
### スクリプトプロパティ
- `OPENAI_API_KEY`: OpenAI APIキー

### 制限事項
- 1実行あたり最大20件
- API使用量制限に注意
- 重複処理防止機能あり

## ファイル構成
```
02_その他セミナー/
├── src/config/
│   ├── common.js           # API設定、ステータス定数
│   └── sheets.js           # OTHER_SEMINAR設定
├── src/processors/
│   └── otherSeminarProcessor.js   # 簡潔化済み処理ロジック（44行）
├── src/services/
│   ├── aiService.js        # OpenAI API連携
│   ├── gmailService.js     # Gmail操作
│   └── sheetService.js     # 動的列検索・更新機能
└── main.js                 # processOtherSeminar等
```

## 改良点
1. **コード簡潔化**: 138行→44行（重複コード削除）
2. **直接更新**: 複雑な更新関数を排除
3. **動的列管理**: AI回答列を安全に追加
4. **統一命名**: TANBATSU → OTHER_SEMINAR
5. **プロジェクト名整合**: 単発 → その他セミナー

## デプロイ手順
1. Clasp設定確認
2. スクリプトプロパティ設定
3. スプレッドシート共有
4. `clasp push`でデプロイ
5. テスト実行で動作確認