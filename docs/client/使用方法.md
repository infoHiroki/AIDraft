# AIDraft 使用方法ガイド

## 基本的な使用の流れ

### 1. データの準備
1. Google Sheetsで問い合わせ/アンケートデータを確認
2. 未処理の質問があることを確認
3. 処理したい件数を把握

### 2. システム実行
1. 該当するGoogle Apps Scriptプロジェクトを開く
2. 実行したい関数を選択
3. 「実行」ボタンをクリック

### 3. 結果の確認
1. Gmail下書きフォルダを確認
2. スプレッドシートで処理状況を確認
3. 必要に応じて下書きを編集・送信

## プロジェクト別実行方法

### 01_お問い合わせ
**URL**: https://script.google.com/d/1PZ0xVB7FtEHQhyTq3GdbuN3SBBmTcXr66NCk7VVe3QJh2F2Ko_KIeN-1/edit

#### 利用可能な関数
- **`processInquiries()`**: 通常の一括処理
- **`testSingleRow()`**: 動作確認用テスト
- **`checkConfig()`**: 設定確認
- **`setupTrigger()`**: 自動実行トリガー設定
- **`deleteTriggers()`**: 自動実行トリガー削除

#### 処理対象
- **F列（質問）**に内容があり、**G列（ステータス）**が空の行

### 02_単発
**URL**: https://script.google.com/d/1bZ2WeL_7bbrYErTThJqfqSvcdBzigbIKEATNdMYUcauUiRpVl9auz3Gz/edit

#### 利用可能な関数
- **`processTanbatsu()`**: 通常の一括処理
- **`testTanbatsuSingleRow()`**: 動作確認用テスト
- **`checkConfig()`**: 設定確認
- **`setupTrigger()`**: 自動実行トリガー設定
- **`deleteTriggers()`**: 自動実行トリガー削除

#### 処理対象
- **H列（質問）**に内容があり、**I列（ステータス）**が空の行

### 03_WeekendEnt
**URL**: https://script.google.com/d/1JzZSAiEYQh2R_uFfxmqdBbDDrbDlfyXpdawh7fTwDaLaJFLap1o0gHul/edit

#### 利用可能な関数
- **`processWeekendEnt()`**: 通常の一括処理
- **`testWeekendEntSingleRow()`**: 動作確認用テスト
- **`checkConfig()`**: 設定確認
- **`setupTrigger()`**: 自動実行トリガー設定
- **`deleteTriggers()`**: 自動実行トリガー削除

#### 処理対象
- **G列（質問）**に内容があり、**H列（ステータス）**が空の行

## 関数の詳細説明

### メイン処理関数
| 関数名 | 用途 | 動作 | 実行頻度 |
|---|---|---|---|
| `processInquiries()` | 01の一括処理 | 未処理質問を最大20件処理 | 手動/定期 |
| `processTanbatsu()` | 02の一括処理 | 未処理質問を最大20件処理 | 手動/定期 |
| `processWeekendEnt()` | 03の一括処理 | 未処理質問を最大20件処理 | 手動/定期 |

### テスト関数
| 関数名 | 用途 | 動作 | 
|---|---|---|
| `testSingleRow()` | 01のテスト | 1件のみ処理（テスト実行として記録） |
| `testTanbatsuSingleRow()` | 02のテスト | 1件のみ処理（テスト実行として記録） |
| `testWeekendEntSingleRow()` | 03のテスト | 1件のみ処理（テスト実行として記録） |

### 設定・管理関数
| 関数名 | 用途 | 確認内容 |
|---|---|---|
| `checkConfig()` | 設定確認 | APIキー設定、シート接続状況 |
| `setupTrigger()` | トリガー設定 | 1時間ごとの定期実行トリガー作成 |
| `deleteTriggers()` | トリガー削除 | 定期実行トリガーの全削除 |

## スプレッドシート仕様（統合出力形式）

### 01_お問い合わせ
- **処理対象**: F列（質問）に内容があり、G列（ステータス）が空
- **G列**: ステータス（`完了`、`エラー`、`テスト実行`）
- **H列**: 統合情報（日時 + Draft ID + AI回答）

### 02_単発
- **処理対象**: H列（質問）に内容があり、I列（ステータス）が空
- **I列**: ステータス（`完了`、`エラー`、`テスト実行`）
- **J列**: 統合情報（日時 + Draft ID + AI回答）

### 03_WeekendEnt
- **処理対象**: G列（質問）に内容があり、H列（ステータス）が空
- **H列**: ステータス（`完了`、`エラー`、`テスト実行`）
- **I列**: 統合情報（日時 + Draft ID + AI回答）

### 統合情報の出力例
```
2025/06/09 14:25
Draft ID: abc123def456
────────────────
田中歯科クリニック
田中太郎先生

GDX事務局 中村です。
...（AI生成回答）...
```

## Gmail下書きの管理

### 自動作成される下書き
| プロジェクト | ラベル | 件名 |
|---|---|---|
| 01_お問い合わせ | "AI自動回答_お問い合わせ" | "Re: セミナーについてのご質問" |
| 02_単発 | "AI自動回答_単発" | "Re: セミナーについてのご質問" |
| 03_WeekendEnt | "AI自動回答_WeekendEnt" | "Re: セミナーについてのご質問" |

### 下書きの編集・送信
1. Gmailの下書きフォルダを開く
2. 該当するラベルで絞り込み
3. 下書きを選択して内容確認
4. 必要に応じて編集
5. 「送信」をクリック

## 定期実行の設定

### Option 1: setupTrigger()関数を使用（推奨）
```javascript
setupTrigger(); // 1時間ごとの自動実行開始
deleteTriggers(); // 自動実行停止
```

### Option 2: 手動でトリガー設定
1. Google Apps Script画面で⏰（トリガー）をクリック
2. 「トリガーを追加」を選択
3. 設定：
   - **実行する関数**: メイン処理関数を選択
   - **イベント ソース**: 時間主導型
   - **時間ベースのトリガータイプ**: 時間ベースのタイマー
   - **時間の間隔を選択**: 1時間おき（推奨）
4. 「保存」をクリック

## 制限事項

### システム制限
- **1回の実行**: 最大20件まで処理
- **AI処理時間**: 1件あたり3-5秒程度
- **Google Apps Script**: 6分間の実行時間制限

### 処理スキップ条件
- 質問欄が空の行
- 既に処理済みの行（ステータス列に文字がある）
- 必須情報（メールアドレス等）が欠けている行

## 料金について

### OpenAI API料金
- **課金対象**: AI処理を行った質問の件数
- **概算料金**: 1件あたり0.1-0.3円程度
- **料金確認**: OpenAIダッシュボードで使用量を確認
- **注意**: 3プロジェクト共通のAPIキーのため、合計使用量で管理

### Google Apps Script
- **基本利用**: 無料
- **制限**: 1日の実行時間に上限あり

## トラブル時の確認項目

### 処理が実行されない場合
1. ✅ 該当プロジェクトでAPIキーが設定されているか
2. ✅ 対象シートへのアクセス権限があるか
3. ✅ 処理対象の行があるか（未処理の質問）
4. ✅ 正しいプロジェクトで実行しているか

### 下書きが作成されない場合
1. ✅ Gmail権限が許可されているか
2. ✅ メールアドレスが正しく入力されているか
3. ✅ エラーログに詳細情報がないか

### AI回答の品質について
- OpenAI APIの応答品質に依存
- 専門的な内容は人手での確認・編集を推奨
- 不適切な回答の場合は下書きを編集してから送信

## 連絡・サポート

問題が解決しない場合は、以下の情報を添えて連絡してください：
- 発生したエラーメッセージ
- 実行ログのスクリーンショット
- 問題が発生した日時
- どのプロジェクトで問題が発生したか
- 処理しようとしたデータの概要